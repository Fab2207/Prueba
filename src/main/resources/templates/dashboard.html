<!DOCTYPE html>
<html class="dark" lang="es" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Panel de Administrador - Oasis Digital</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      .material-symbols-outlined {
        font-variation-settings: "FILL" 0, "wght" 400, "GRAD" 0, "opsz" 24;
        line-height: 1;
      }
      .material-symbols-outlined.fill {
        font-variation-settings: "FILL" 1;
      }
    </style>
    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              primary: "#009B77",
              accent: "#FFD700",
              "background-light": "#f0f2f5",
              "background-dark": "#121212",
              "surface-dark": "#1E1E1E",
              "border-dark": "#2A2A2A",
              "text-light": "#EAEAEA",
              "text-dark": "#B0B0B0",
            },
            fontFamily: {
              display: ["Inter", "sans-serif"],
            },
            borderRadius: {
              DEFAULT: "0.5rem",
              lg: "1rem",
              xl: "1.5rem",
              full: "9999px",
            },
          },
        },
      };
    </script>
  </head>
  <body class="bg-background-light dark:bg-background-dark font-display">
    <div class="relative flex w-full min-h-screen">
      <!-- SideNavBar -->
      <aside
        class="flex flex-col flex-shrink-0 w-64 bg-background-light dark:bg-surface-dark border-r border-transparent dark:border-border-dark"
      >
        <div class="flex flex-col flex-grow p-4">
          <div class="flex items-center gap-3 px-3 py-4">
            <div
              class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10"
              data-alt="Logo de Oasis Digital"
              style="
                background-image: url('https://lh3.googleusercontent.com/aida-public/AB6AXuDc5T5_SdMoA5-csyYbqLoe7uhC07tAZYhVtyhUGMa6SBLs-SxCXAabpoJYpGNKY3dbBUsj9wjacLbRF0yHriw2oKamO_by2Dc6Snszn8Zx0L3RjRc_X8N5prccBypWO8JnlkY81UTLD0kL76ItbBONCkP-d1qH78y4TiCD3j_iIkMn3wfZ2UBuOH22U2Qxdm5kIBeBQo4J2Zb7R05MOPpmcZS8xNOts-0LszDfkdUrMTqdEqi2X0DH6bBOU-Dq2aAQY8SgOuUqk3w');
              "
            ></div>
            <div class="flex flex-col">
              <h1
                class="text-gray-800 dark:text-text-light text-base font-bold leading-normal"
              >
                Oasis Digital
              </h1>
              <p
                class="text-gray-500 dark:text-text-dark text-sm font-normal leading-normal"
              >
                Gestión Hotelera
              </p>
            </div>
          </div>
          <nav class="flex flex-col gap-2 mt-6">
            <a
              class="flex items-center gap-3 px-3 py-2.5 rounded-lg bg-primary/20 text-primary"
              th:href="@{/dashboard}"
            >
              <span class="material-symbols-outlined fill text-xl"
                >dashboard</span
              >
              <p class="text-sm font-semibold leading-normal">Panel</p>
            </a>
            <a
              class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-gray-600 dark:text-text-dark hover:bg-gray-100 dark:hover:bg-border-dark transition-colors"
              th:href="@{/reservas}"
            >
              <span class="material-symbols-outlined text-xl"
                >calendar_month</span
              >
              <p class="text-sm font-medium leading-normal">Reservas</p>
            </a>
            <a
              class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-gray-600 dark:text-text-dark hover:bg-gray-100 dark:hover:bg-border-dark transition-colors"
              th:href="@{/clientes}"
            >
              <span class="material-symbols-outlined text-xl">group</span>
              <p class="text-sm font-medium leading-normal">Huéspedes</p>
            </a>
            <a
              class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-gray-600 dark:text-text-dark hover:bg-gray-100 dark:hover:bg-border-dark transition-colors"
              th:href="@{/habitaciones}"
            >
              <span class="material-symbols-outlined text-xl">bed</span>
              <p class="text-sm font-medium leading-normal">Habitaciones</p>
            </a>
            <a
              class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-gray-600 dark:text-text-dark hover:bg-gray-100 dark:hover:bg-border-dark transition-colors"
              th:href="@{/reportes}"
            >
              <span class="material-symbols-outlined text-xl">pie_chart</span>
              <p class="text-sm font-medium leading-normal">Reportes</p>
            </a>
          </nav>
          <div class="mt-auto">
            <a
              class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-gray-600 dark:text-text-dark hover:bg-gray-100 dark:hover:bg-border-dark transition-colors"
              th:href="@{/configuracion}"
            >
              <span class="material-symbols-outlined text-xl">settings</span>
              <p class="text-sm font-medium leading-normal">Configuración</p>
            </a>
            <form th:action="@{/logout}" method="post" class="w-full">
              <button
                type="submit"
                class="flex items-center gap-3 px-3 py-2.5 rounded-lg text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors w-full"
              >
                <span class="material-symbols-outlined text-xl">logout</span>
                <p class="text-sm font-medium leading-normal">Cerrar Sesión</p>
              </button>
            </form>
          </div>
        </div>
      </aside>
      <!-- Main Content -->
      <main class="flex-1 flex flex-col">
        <!-- TopNavBar -->
        <header
          class="flex items-center justify-between whitespace-nowrap border-b border-transparent dark:border-border-dark px-8 py-4 bg-background-light dark:bg-surface-dark"
        >
          <h2
            class="text-gray-900 dark:text-text-light text-lg font-bold leading-tight tracking-[-0.015em]"
          >
            Panel de Administrador
          </h2>
          <div class="flex items-center gap-4">
            <button
              class="flex min-w-[84px] cursor-pointer items-center justify-center gap-2 overflow-hidden rounded-lg h-10 px-4 bg-gray-100 dark:bg-border-dark text-gray-800 dark:text-text-light text-sm font-medium leading-normal hover:bg-gray-200 dark:hover:bg-opacity-80 transition-colors"
            >
              <span class="material-symbols-outlined text-lg"
                >calendar_today</span
              >
              <span class="truncate">Hoy</span>
            </button>
            <button
              class="flex cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 bg-gray-100 dark:bg-border-dark text-gray-800 dark:text-text-light aspect-square hover:bg-gray-200 dark:hover:bg-opacity-80 transition-colors"
            >
              <span class="material-symbols-outlined text-xl"
                >notifications</span
              >
            </button>
            <div class="flex items-center gap-3">
              <div
                class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10"
                data-alt="Foto de perfil"
                style="
                  background-image: url('https://ui-avatars.com/api/?name=Admin&background=0D8ABC&color=fff');
                "
              ></div>
              <div class="flex flex-col text-right">
                <span
                  class="text-gray-800 dark:text-text-light text-sm font-semibold"
                  th:text="${empleadoActual != null ? empleadoActual.nombres : 'Admin'}"
                  >Admin</span
                >
                <span
                  class="text-gray-500 dark:text-text-dark text-xs"
                  th:text="${empleadoActual != null ? empleadoActual.rol : 'Administrador'}"
                  >Administrador</span
                >
              </div>
            </div>
          </div>
        </header>
        <!-- Dashboard Content -->
        <div class="flex-1 overflow-y-auto p-8">
          <!-- Stats -->
          <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div
              class="flex flex-col gap-2 rounded-xl p-6 bg-background-light dark:bg-surface-dark border border-transparent dark:border-border-dark"
            >
              <div
                class="flex items-center justify-between text-gray-500 dark:text-text-dark"
              >
                <p class="text-base font-medium leading-normal">
                  Ocupación Actual
                </p>
                <span class="material-symbols-outlined text-primary">bed</span>
              </div>
              <p
                class="text-gray-900 dark:text-text-light tracking-tight text-3xl font-bold leading-tight"
                th:text="${(habitacionesOcupadas * 100) / (totalHabitaciones > 0 ? totalHabitaciones : 1)} + '%'"
              >
                0%
              </p>
              <p
                class="text-primary text-sm font-medium leading-normal"
                th:text="${habitacionesOcupadas} + ' de ' + ${totalHabitaciones} + ' habitaciones'"
              >
                0 de 0
              </p>
            </div>
            <div
              class="flex flex-col gap-2 rounded-xl p-6 bg-background-light dark:bg-surface-dark border border-transparent dark:border-border-dark"
            >
              <div
                class="flex items-center justify-between text-gray-500 dark:text-text-dark"
              >
                <p class="text-base font-medium leading-normal">
                  Ingresos Totales
                </p>
                <span class="material-symbols-outlined text-primary"
                  >payments</span
                >
              </div>
              <p
                class="text-gray-900 dark:text-text-light tracking-tight text-3xl font-bold leading-tight"
                th:text="'S/. ' + ${ingresosTotales}"
              >
                S/. 0.00
              </p>
              <p class="text-primary text-sm font-medium leading-normal">
                Acumulado histórico
              </p>
            </div>
            <div
              class="flex flex-col gap-2 rounded-xl p-6 bg-background-light dark:bg-surface-dark border border-transparent dark:border-border-dark"
            >
              <div
                class="flex items-center justify-between text-gray-500 dark:text-text-dark"
              >
                <p class="text-base font-medium leading-normal">
                  Check-ins / Check-outs
                </p>
                <span class="material-symbols-outlined text-primary"
                  >login</span
                >
              </div>
              <p
                class="text-gray-900 dark:text-text-light tracking-tight text-3xl font-bold leading-tight"
                th:text="${checkInsHoy} + ' / ' + ${checkOutsHoy}"
              >
                0 / 0
              </p>
              <p class="text-text-dark text-sm font-medium leading-normal">
                Previstos para hoy
              </p>
            </div>
          </div>
          <!-- Charts -->
          <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mt-6">
            <div
              class="lg:col-span-2 flex flex-col gap-2 rounded-xl p-6 bg-background-light dark:bg-surface-dark border border-transparent dark:border-border-dark"
            >
              <p
                class="text-gray-800 dark:text-text-light text-base font-semibold leading-normal"
              >
                Tendencia de Ingresos
              </p>
              <div class="flex items-baseline gap-2">
                <p
                  class="text-gray-900 dark:text-white tracking-tight text-3xl font-bold leading-tight truncate"
                  th:text="'S/. ' + ${ingresosTotales}"
                >
                  S/. 0.00
                </p>
                <p class="text-primary text-base font-medium leading-normal">
                  +8.2%
                </p>
              </div>
              <p
                class="text-gray-500 dark:text-text-dark text-sm font-normal leading-normal"
              >
                Últimos 30 días
              </p>
              <div class="flex min-h-[240px] flex-1 flex-col pt-8 relative">
                <canvas id="ingresosChart"></canvas>
              </div>
            </div>
            <div
              class="flex flex-col gap-4 rounded-xl p-6 bg-background-light dark:bg-surface-dark border border-transparent dark:border-border-dark"
            >
              <p
                class="text-gray-800 dark:text-text-light text-base font-semibold leading-normal"
              >
                Distribución de Habitaciones
              </p>
              <div
                class="flex flex-1 items-center justify-center min-h-[240px] relative"
              >
                <div class="relative w-48 h-48">
                  <canvas id="habitacionesChart"></canvas>
                  <div
                    class="absolute inset-0 flex flex-col items-center justify-center pointer-events-none"
                  >
                    <span
                      class="text-3xl font-bold text-gray-900 dark:text-white"
                      th:text="${habitacionesOcupadas}"
                      >0</span
                    >
                    <span class="text-sm text-gray-500 dark:text-text-dark"
                      >Ocupadas</span
                    >
                  </div>
                </div>
              </div>
              <script th:inline="javascript">
                document.addEventListener("DOMContentLoaded", function () {
                  // Datos para gráfico de habitaciones
                  const total = /*[[${totalHabitaciones}]]*/ 1;
                  const ocupadas = /*[[${habitacionesOcupadas}]]*/ 0;
                  const mantenimiento = /*[[${habitacionesMantenimiento}]]*/ 0;
                  const disponibles = /*[[${habitacionesDisponibles}]]*/ 0;

                  const ctxHabitaciones = document
                    .getElementById("habitacionesChart")
                    .getContext("2d");
                  new Chart(ctxHabitaciones, {
                    type: "doughnut",
                    data: {
                      labels: ["Ocupadas", "Mantenimiento", "Disponibles"],
                      datasets: [
                        {
                          data: [ocupadas, mantenimiento, disponibles],
                          backgroundColor: ["#009B77", "#FFD700", "#2A2A2A"],
                          borderWidth: 0,
                          hoverOffset: 4,
                        },
                      ],
                    },
                    options: {
                      responsive: true,
                      maintainAspectRatio: false,
                      cutout: "80%",
                      plugins: {
                        legend: { display: false },
                        tooltip: {
                          callbacks: {
                            label: function (context) {
                              let label = context.label || "";
                              if (label) {
                                label += ": ";
                              }
                              let value = context.raw;
                              let percentage =
                                ((value / total) * 100).toFixed(1) + "%";
                              return label + value + " (" + percentage + ")";
                            },
                          },
                        },
                      },
                    },
                  });

                  // Datos para gráfico de ingresos
                  const ingresosData = /*[[${ingresosUltimos30Dias}]]*/ [];
                  const labels = ingresosData.map((d) => {
                    const date = new Date(d.fecha);
                    return date.toLocaleDateString("es-ES", {
                      day: "numeric",
                      month: "short",
                    });
                  });
                  const data = ingresosData.map((d) => d.ingresos);

                  const ctxIngresos = document
                    .getElementById("ingresosChart")
                    .getContext("2d");

                  // Crear gradiente
                  const gradient = ctxIngresos.createLinearGradient(
                    0,
                    0,
                    0,
                    400
                  );
                  gradient.addColorStop(0, "rgba(0, 155, 119, 0.5)");
                  gradient.addColorStop(1, "rgba(0, 155, 119, 0.0)");

                  new Chart(ctxIngresos, {
                    type: "line",
                    data: {
                      labels: labels,
                      datasets: [
                        {
                          label: "Ingresos",
                          data: data,
                          borderColor: "#009B77",
                          backgroundColor: gradient,
                          borderWidth: 2,
                          fill: true,
                          tension: 0.4,
                          pointRadius: 0,
                          pointHoverRadius: 4,
                        },
                      ],
                    },
                    options: {
                      responsive: true,
                      maintainAspectRatio: false,
                      plugins: {
                        legend: { display: false },
                        tooltip: {
                          mode: "index",
                          intersect: false,
                          callbacks: {
                            label: function (context) {
                              let label = context.dataset.label || "";
                              if (label) {
                                label += ": ";
                              }
                              if (context.parsed.y !== null) {
                                label += new Intl.NumberFormat("es-PE", {
                                  style: "currency",
                                  currency: "PEN",
                                }).format(context.parsed.y);
                              }
                              return label;
                            },
                          },
                        },
                      },
                      scales: {
                        x: {
                          grid: { display: false },
                          ticks: {
                            maxTicksLimit: 10,
                            color: "#9CA3AF",
                          },
                        },
                        y: {
                          beginAtZero: true,
                          grid: {
                            color: "rgba(255, 255, 255, 0.05)",
                          },
                          ticks: {
                            color: "#9CA3AF",
                            callback: function (value) {
                              return "S/ " + value;
                            },
                          },
                        },
                      },
                      interaction: {
                        mode: "nearest",
                        axis: "x",
                        intersect: false,
                      },
                    },
                  });
                });
              </script>
              <div class="grid grid-cols-2 gap-x-4 gap-y-2 text-sm">
                <div class="flex items-center gap-2">
                  <div class="w-3 h-3 rounded-full bg-primary"></div>
                  <span class="text-gray-600 dark:text-text-dark"
                    >Ocupadas</span
                  >
                </div>
                <span
                  class="font-semibold text-right text-gray-800 dark:text-text-light"
                  th:text="${habitacionesOcupadas}"
                  >0</span
                >
                <div class="flex items-center gap-2">
                  <div class="w-3 h-3 rounded-full bg-accent"></div>
                  <span class="text-gray-600 dark:text-text-dark"
                    >Mantenimiento</span
                  >
                </div>
                <span
                  class="font-semibold text-right text-gray-800 dark:text-text-light"
                  th:text="${habitacionesMantenimiento}"
                  >0</span
                >
                <div class="flex items-center gap-2">
                  <div class="w-3 h-3 rounded-full bg-border-dark"></div>
                  <span class="text-gray-600 dark:text-text-dark"
                    >Disponibles</span
                  >
                </div>
                <span
                  class="font-semibold text-right text-gray-800 dark:text-text-light"
                  th:text="${habitacionesDisponibles}"
                  >0</span
                >
              </div>
            </div>
          </div>
          <!-- SectionHeader & Table -->
          <h2
            class="text-gray-900 dark:text-white text-xl font-bold leading-tight tracking-[-0.015em] pt-8 pb-4"
          >
            Últimas Reservas
          </h2>
          <div
            class="rounded-xl bg-background-light dark:bg-surface-dark border border-transparent dark:border-border-dark overflow-hidden"
          >
            <div class="overflow-x-auto">
              <table class="w-full text-sm text-left">
                <thead
                  class="bg-gray-50 dark:bg-border-dark text-xs text-gray-500 dark:text-text-dark uppercase"
                >
                  <tr>
                    <th class="px-6 py-3" scope="col">Huésped</th>
                    <th class="px-6 py-3" scope="col">Check-in</th>
                    <th class="px-6 py-3" scope="col">Check-out</th>
                    <th class="px-6 py-3" scope="col">Habitación</th>
                    <th class="px-6 py-3" scope="col">Estado</th>
                  </tr>
                </thead>
                <tbody>
                  <tr
                    class="border-b border-transparent dark:border-border-dark"
                    th:each="reserva : ${ultimasReservas}"
                  >
                    <td
                      class="px-6 py-4 font-medium text-gray-900 dark:text-white whitespace-nowrap"
                      th:text="${reserva.cliente.nombres}"
                    >
                      Cliente
                    </td>
                    <td
                      class="px-6 py-4 text-gray-600 dark:text-text-dark"
                      th:text="${#temporals.format(reserva.fechaInicio, 'dd MMM, yyyy')}"
                    >
                      15 Ago, 2024
                    </td>
                    <td
                      class="px-6 py-4 text-gray-600 dark:text-text-dark"
                      th:text="${#temporals.format(reserva.fechaFin, 'dd MMM, yyyy')}"
                    >
                      20 Ago, 2024
                    </td>
                    <td
                      class="px-6 py-4 text-gray-600 dark:text-text-dark"
                      th:text="${reserva.habitacion.numero} + ' - ' + ${reserva.habitacion.tipo}"
                    >
                      Suite
                    </td>
                    <td class="px-6 py-4">
                      <span
                        class="px-2 py-1 text-xs font-medium rounded-full"
                        th:classappend="${reserva.estadoReserva == 'ACTIVA' ? 'text-green-800 bg-green-200 dark:text-green-200 dark:bg-green-900/50' : 
                        (reserva.estadoReserva == 'PENDIENTE' ? 'text-yellow-800 bg-yellow-200 dark:text-accent dark:bg-accent/20' : 
                        (reserva.estadoReserva == 'FINALIZADA' ? 'text-gray-800 bg-gray-200 dark:text-gray-200 dark:bg-gray-700/50' : 'text-red-800 bg-red-200 dark:text-red-200 dark:bg-red-900/50'))}"
                        th:text="${reserva.estadoReserva}"
                        >Confirmada</span
                      >
                    </td>
                  </tr>
                  <tr th:if="${#lists.isEmpty(ultimasReservas)}">
                    <td colspan="5" class="px-6 py-4 text-center text-gray-500">
                      No hay reservas recientes.
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </main>
    </div>
  </body>
</html>
